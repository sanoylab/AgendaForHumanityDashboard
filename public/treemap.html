<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">

  <title>Agenda for Humanity Viz | Dashboard | Subcategory analysis</title>

  <!--display content in highest mode available. -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <!--responsive page-->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">

  <!--source for icons used on the website-->
  <link rel="stylesheet" href="vendor/font-awesome/css/font-awesome.min.css">
  <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="vendor/Ionicons/css/ionicons.min.css">
  <link rel="shortcut icon" href="img/favicon.png" type="image/vnd.microsoft.icon" />

  <!--Page Theme-->
  <link rel="stylesheet" href="css/AdminLTE.min.css">
  <link rel="stylesheet" href="css/skins/skin-blue.min.css">
  <link rel="stylesheet" href="vendor/bootstrap/dist/css/bootstrap.min.css">

  <!--  C3 -->
    <link rel="stylesheet" href="css/c3.css">

  <!--Google font-->
  <link rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">


  <style>
    <!-- Up and Down Arrows -->
    .sortable th.descend:after {
         content: "\25B2";
     }

     .sortable th.ascend:after {
         content: "\25BC";
     }

     div.ex1 {
       overflow-x: scroll;
    }

    div {
      word-wrap: break-word;
    }
  </style>
</head>


<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">
  <!-------------------------------------------------->
  <!-- Main Header -->
  <header class="main-header">

      <!-- Logo -->
      <a href="index2.html" class="logo">
          <!-- mini logo for sidebar mini 50x50 pixels, when side menu is expanded-collapsed -->
          <span class="logo-mini"><b>V</b>IZ</span>
          <!-- logo for regular state and mobile devices-->
          <span class="logo-lg"><b>Dashboard VIZ</b></span>
      </a>

      <!-- Header Navbar -->
      <nav class="navbar navbar-static-top" role="navigation">

              <!-- Sidebar toggle button-->
              <a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button">
                  <span class="sr-only">Toggle navigation</span>
              </a>

              <!-- Navbar Right Menu, most menu have been disabled. Standard text is provided "Welcome to AFH..." -->
              <div class="navbar-custom-menu">
                  <ul class="nav navbar-nav">

                          <!-- Messages: style can be found in dropdown.less-->
                          <li class="dropdown messages-menu">
                          <!-- Menu toggle button -->

                          <!-- /.messages-menu -->

                          <!-- Notifications Menu -->

                          <!-- Tasks Menu -->

                          <!-- User Account Menu -->
                          <li class="dropdown user user-menu">
                              <!-- Menu Toggle Button -->
                              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                  <!-- The user image in the navbar-->

                                  <!-- hidden-xs hides the username on small devices so only the image appears. -->
                                  <span class="hidden-xs">Welcome to Agenda for Humanitarian Data Visualization
                                      Dashboard</span>
                              </a>
                          </li>

                          <!-- Control Sidebar Toggle Button -->
                    </ul>
                </div>
      </nav>
  </header>


  <!-------------------------------------------------->
  <!-- Left side column. contains the logo and sidebar -->
  <aside class="main-sidebar">

      <!-- sidebar: style can be found in sidebar.less -->
      <section class="sidebar">

          <!-- Sidebar user panel (optional) -->
          <div class="user-panel">
              <div class="pull-left image">

              </div>

          </div>

          <!-- search form (Optional) -->

          <!-- /.search form -->

          <!-- Sidebar Menu -->
          <ul class="sidebar-menu" data-widget="tree">
              <li class="header">MAIN NAVIGATION</li>
              <!-- Optionally, you can add icons to the links -->
              <li><a href="index.html"><i class="fas fa-tv"></i> &nbsp;<span>Dashboard</span></a></li>
              <li><a href="transformation.html"><i class="fas fa-laptop"></i> <span>Transformation</span></a></li>
              <li><a href="stakeholder.html"><i class="fas fa-user-friends"></i> &nbsp;
                      <span>Stakeholders</span></a></li>
              <li><a href="challenges.html"><i class="fas fa-desktop"></i> &nbsp; <span>Challenges</span></a></li>
              <li><a class="active" href="treemap2.html"><i class="fas fa-cubes"></i> &nbsp;<span>Subcategories</span></a></li>
          </ul>
          <table style="margin-top: 50px; color: #fff;" class="table  table-condesed">
                  <tr><td>1A - Demonstrate timely, coherent and decisive political leadership	</td></tr>
                  <tr><td>1B - Act early	</td></tr>
                  <tr><td>1C - Remain engaged and invest in stability	</td></tr>
                  <tr><td>1D - Develop solutions with and for people	</td></tr>
                  <tr><td>2A - Respect and protect civilians and civilian objects in the conduct of hostilities	</td></tr>
                  <tr><td>2B - Ensure full access to and protection of the humanitarian and medical missions	</td></tr>
                  <tr><td>2C - Speak out on violations	</td></tr>
                  <tr><td>2D - Take concrete steps to improve compliance and accountability	</td></tr>
                  <tr><td>2E - Uphold the rules: a global campaign to affirm the norms that safeguard humanity	</td></tr>
                  <tr><td>3A - Reduce and address displacement	</td></tr>
                  <tr><td>3B - Address the vulnerabilities of migrants and provide more regular and lawful opportunities for migration	</td></tr>
                  <tr><td>3C - End statelessness in the next decade	</td></tr>
                  <tr><td>3D - Empower and protect women and girls	</td></tr>
                  <tr><td>3E - Eliminate gaps in education for children, adolescents and young people	</td></tr>
                  <tr><td>3F - Enable adolescents and young people to be agents of positive transformation	</td></tr>
                  <tr><td>3G - Address other groups or minorities in crisis settings	</td></tr>
                  <tr><td>4A - Reinforce, do not replace, national and local systems	</td></tr>
                  <tr><td>4B - Anticipate, do not wait, for crises	</td></tr>
                  <tr><td>4C - Deliver collective outcomes: transcend humanitarian-development divides	</td></tr>
                  <tr><td>5A - Invest in local capacities	</td></tr>
                  <tr><td>5B - Invest according to risk	</td></tr>
                  <tr><td>5C - Invest in stability	</td></tr>
                  <tr><td>5D - Finance outcomes, not fragmentation: shift from funding to financing	</td></tr>
                  <tr><td>5E - Diversify the resource base and increase cost-efficiency	</td></tr>
                </table>
      </section>
  </aside>


  <!-------------------------------------------------->
  <div class="content-wrapper">
      <section class="content-header">
          <h1>
                  Subcategory Analysis

          </h1>

      </section>

      <section class="content container-fluid">

          <div class="row">
              <div class="col-md-12">
                  <div class="box box-warning">
                      <div class="box-header with-border">
                          <h3 class="box-title">Subcategory Treemap</h3>
                      </div>
                      <ul class="nav nav-tabs">
                        <li><a href="TreeSubcatActions.html">View 1</a></li>
                        <li><a href="TreeActions.html">View 2</a></li>
                        <li class="active"><a href="treemap.html">View 3</a></li>
                      </ul>
                      <div class="box-body no-padding ex1"  style="padding-left: 20px;padding-right: 20px;">
                          <div id="treemap_viz"></div>
                      </div>
                  </div>
              </div>
      </section>
    </div>


    <!-------------------------------------------------->
    <footer class="main-footer">
        <!-- To the right -->
        <div class="pull-right hidden-xs">

        </div>
        <!-- Default to the left -->
        <strong>Copyright &copy; 2019. Agenda For Humanity.</strong> All rights reserved.
    </footer>



    <!---------------------------------------------->
    <!---------------------------------------------->
    <!-- REQUIRED JS SCRIPTS -->
    <!-- jQuery 3 -->
    <script src="vendor/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap 3.3.7 -->
    <script src="vendor/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- AdminLTE App -->
    <script src="js/adminlte.min.js"></script>
    <script src="js/spin.js"></script>

    <!-- Load d3.js and c3-->
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <!--<script type="text/javascript" src="http://mbostock.github.com/d3/d3.layout.js"></script>-->

    <script type="text/javascript">
        //-------------------------------------------
        //-------------------------------------------
        function wrap(text, width) {
      text.each(function () {
          var text = d3.select(this),
              words = text.text().split(/\s+/).reverse(),
              word,
              line = [],
              lineNumber = 0,
              lineHeight = 1.1, // ems
              x = text.attr("x"),
              y = text.attr("y"),
              dy = 0, //parseFloat(text.attr("dy")),
              width= text.attr("width")
              tspan = text.text(null)
                          .append("tspan")
                          .attr("x", x)
                          .attr("y", y)
                          .attr("dy", dy + "em");
              console.log("hello2: " + width);
              console.log("words"+words);
          while (word = words.pop()) {
              line.push(word);
              tspan.text(line.join(" "));
              if (tspan.node().getComputedTextLength() > width) {
                console.log("I made it into the line wrapping if condition");
                  line.pop();
                  tspan.text(line.join(" "));
                  line = [word];
                  tspan = text.append("tspan")
                              .attr("x", x)
                              .attr("y", y)
                              .attr("dy", ++lineNumber * lineHeight + dy + "em")
                              .text(word);
              }
          }
      });
  }
        //-------------------------------------------
        //-------------------------------------------
</script>

  <script>

  // set the dimensions and margins of the graph
  var obj = document.getElementById('treemap_viz');
  var divWidth = obj.offsetWidth;

  var margin = {top: 10, right: 10, bottom: 10, left: 10},
    width = divWidth - margin.left - margin.right,
    height = 1900 - margin.top - margin.bottom;

  // append the svg object to the body of the page
  var svg = d3.select("#treemap_viz")
  .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");




  // read json data
  d3.json("https://www.agendaforhumanity.org/viz_endpoint/subcatActions/getSubcatOne.php", function(data) {



    // Give the data to this cluster layout:
    var root = d3.hierarchy(data).sum(function(d){ return d.value}) // Here the size of each leave is given in the 'value' field in input data
                                                                    // traverses the tree and sets .value on each node to the sum of its children

    // Then d3.treemap computes the position of each element of the hierarchy
    d3.treemap()
      .size([width, height])
      .paddingTop(28)
      .paddingRight(7)
      .paddingInner(3)      // Padding between each rectangle
      //.paddingOuter(6)
      //.padding(20)
      (root)


    // prepare a color scale
    var color = d3.scaleOrdinal()
      .domain(["boss1", "boss2", "boss3"])
      .range([ "#402D54", "#D18975", "#8FD175"])


    // And a opacity scale
    var opacity = d3.scaleLinear()
      .domain([10, 30])
      .range([.5,1])



    // use this information to add rectangles:
    svg
      .selectAll("rect")
      .data(root.leaves())
      .enter()
      .append("rect")
        .attr('x', function (d) { console.log("x0-rect: "+d.x0); console.log("x1-rect: "+d.x1); return d.x0; })
        .attr('y', function (d) { console.log("y0-rect: "+d.y0); console.log("y1-rect: "+d.y1); return d.y0; })
        .attr('width', function (d) {console.log(d.x1 - d.x0); return d.x1 - d.x0; })
        .attr('height', function (d) { return d.y1 - d.y0; })
        .style("stroke", "black")
        .style("fill", function(d){ return color(d.parent.data.name)} )
        .style("opacity", function(d){ return opacity(d.data.value)})



    // and to add the text labels
    svg
      .selectAll("text")
      .data(root.leaves())
      .enter()
      .append("text")
        .attr("x", function(d){ return d.x0+5})    // +10 to adjust position (more right)
        .attr("y", function(d){ return d.y0+20})    // +20 to adjust position (lower)
        .attr('width', function (d) {console.log("hello"+ d.x1-d.x0); return d.x1 - d.x0; })
        .text(function(d){ return d.data.name })
        .attr("font-size", "10px")
        .attr("fill", "black")
        .call(wrap)

        //.attr("width", function(d) {return d.x1 - d.x0; })


    // and to add the text labels
    svg
      .selectAll("vals")
      .data(root.leaves())
      .enter()
      .append("text")
        .attr("x", function(d){ return d.x0+5})    // +10 to adjust position (more right)
        .attr("y", function(d){ return d.y0+35})    // +20 to adjust position (lower)
        .text(function(d){ return d.data.value })
        .attr("font-size", "11px")
        .attr("fill", "black")

    // Add title for the 3 groups
    svg
      .selectAll("titles")
      .data(root.descendants().filter(function(d){return d.depth==1}))
      .enter()
      .append("text")
        .attr("x", function(d){console.log("x-title: "+ d.x0); return d.x0})
        .attr("y", function(d){console.log("y-title: "+ d.y0); return d.y0+21})
        .attr('width', function (d) {console.log(d.x1 - d.x0); return d.x1 - d.x0; })
        .text(function(d){ console.log("title: "+d.data.name); return d.data.name })
        .attr("font-size", "14px")
        .attr("fill",  function(d){ return color(d.data.name)} )
        //.attr("width", function(d) {return d.x1 - d.x0; })
        .call(wrap);
/*
    // Add title for the 3 groups
    svg
      .append("text")
        .attr("x", 0)
        .attr("y", 14)    // +20 to adjust position (lower)
        //.text("Three group leaders and 14 employees")
        .attr("font-size", "19px")
        .attr("fill",  "grey" )
        */

      })
    </script>
  </div>
</body>
</html>
